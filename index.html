<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Trello Export Power-Up</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Load the Trello Power-Up library -->
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
  </head>
  <body>
    <script>
      // URL for your custom icon (must be HTTPS)
      const ICON_URL = 'https://rkwm713.github.io/ServOS-Export/icon.png';

      // Utility function for error logging and handling
      const handleError = (error) => {
        console.error('Power-Up Error:', error);
        return { error: true, message: error.message || 'An unexpected error occurred' };
      };

      // Define the board-button capability to open the export popup
      const boardButtonsCapability = (t, options) => {
        return [{
          icon: {
            dark: ICON_URL,
            light: ICON_URL
          },
          text: 'Export Cards',
          condition: 'always',
          callback: async function(t) {
            try {
              return t.popup({
                title: 'Export Cards Data',
                url: './export.html',
                height: 500,  // Adjust popup height as needed
                fullscreen: false
              });
            } catch (error) {
              handleError(error);
            }
          }
        }];
      };

      // Initialize the Power-Up (only on the connector page)
      TrelloPowerUp.initialize({
        'board-buttons': boardButtonsCapability,
        'authorization-status': async (t, options) => {
          const authStatus = await t.get('member', 'private', 'authStatus');
          return { authorized: !!authStatus };
        },
        'show-settings': async (t, options) => {
          try {
            // Create settings.html if you wish to add settings
            return t.popup({
              title: 'Export Settings',
              url: './settings.html',
              height: 200
            });
          } catch (error) {
            handleError(error);
          }
        }
      }, {
        appName: 'ServOS Export',
        apiVersion: 1,
        enableContext: true
      });
    </script>
  </body>
</html>
