<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Trello Export Power-Up</title>
  <!-- This loads the Trello Power-Up client library -->
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <script>
    // This code initializes your Power-Up and tells Trello what buttons to show.
    TrelloPowerUp.initialize({
      // This creates a board button (a button you see on the Trello board)
      'board-buttons': function(t, options) {
        return [{
          // Optional: Replace the URL below with your own icon URL if desired.
          icon: 'https://rkwm713.github.io/ServOS-Export/icon.png',
          text: 'Export Cards',
          callback: function(t) {
            // When the button is clicked, open the popup defined in export.html.
            return t.popup({
              title: 'Export Cards Data',
              url: 'export.html',
              height: 400  // You can adjust the popup height as needed.
            });
          }
        }];
      }
    });

    document.getElementById('exportBtn').addEventListener('click', function() {
      // First check if we have the required capabilities
      t.getRestApi()
        .isAuthorized()
        .then(function(authorized) {
          if (!authorized) {
            // Request authorization if not already granted
            return t.getRestApi().authorize({ scope: 'read' });
          }
        })
        .then(function() {
          // Proceed with data fetching
          return Promise.all([
            t.board('all'),  // Changed from just 'cards' to 'all'
            t.lists('all'),  // Changed from board('lists')
            t.board('members'),
            t.board('customFields')
          ]);
        })
        .then(function(results) {
          // Rest of your existing code...
        })
        .catch(function(error) {
          console.error('Error:', error);
          document.getElementById('output').textContent = 'Error: ' + error.message;
        });
    });
  </script>
</body>
</html>
